# 🛡️ 攻防演练系统完整指南

## 📋 系统概述

这是一个完整的网络安全攻防演练系统，具备以下核心功能：

### 🎯 核心特性
- **实时攻防对抗**: 攻击智能体 vs 防御智能体组
- **智能防御协调**: 自动触发防御响应和可视化动画
- **胜负判定系统**: 实时监控并判定演练结果
- **可视化动画**: 攻击路径和防御行动的实时可视化
- **详细战报**: 完整的攻防统计和分析报告

### 🏗️ 系统架构

```
攻防演练系统
├── 后端服务 (backend/main.py)
│   ├── WebSocket日志服务 (端口 8080)
│   └── API接口服务
├── 攻击方
│   ├── 攻击智能体 (agents/attack_agent/main.py)
│   └── 中央智能体 (agents/central_agent/main.py)
├── 防御方
│   ├── 威胁阻断智能体 (端口 8011)
│   ├── 漏洞修复智能体 (端口 8012)
│   ├── 攻击溯源智能体 (端口 8013)
│   ├── 防御协调器 (WebSocket监听)
│   └── 攻防演练裁判 (WebSocket监听)
└── 前端界面
    ├── 拓扑图可视化 (TopologyView.vue)
    ├── 攻击动画系统 (FabricAttackVisualization.js)
    ├── 防御动画系统 (FabricDefenseVisualization.js)
    └── 胜负判定显示系统
```

## 🚀 快速启动

### 方法一：一键启动（推荐）

```bash
# 在项目根目录下运行
python start_battle_system.py
```

### 方法二：手动启动

```bash
# 1. 启动后端服务
cd backend && python main.py

# 2. 启动防御智能体组（新终端）
cd agents/defense_agent && python start_defense_agents.py

# 3. 启动攻击智能体（新终端）
cd agents/attack_agent && python main.py

# 4. 启动中央智能体（新终端）
cd agents/central_agent && python main.py
```

## 🎮 使用流程

### 1. 系统启动
- 运行启动脚本，确保所有服务正常启动
- 检查控制台输出，确认各组件连接状态

### 2. 前端操作
1. 打开前端界面（通常是 `http://localhost:3000` 或 `http://localhost:5173`）
2. 进入 **对抗演练** → **拓扑图** 页面
3. 生成或加载攻防场景
4. 部署容器环境（如需要）

### 3. 开始演练
1. 在拓扑图页面启动攻击智能体
2. 观察实时的攻防对抗过程
3. 查看可视化动画效果
4. 等待胜负判定结果

## 🛡️ 防御可视化系统

### 防御动画类型

#### 1. 威胁阻断动画 🛡️
- **触发条件**: 检测到恶意IP、端口扫描等威胁
- **动画效果**: 
  - 防护盾牌出现
  - 阻断符号显示
  - 防火墙规则更新动画

#### 2. 漏洞修复动画 🔧
- **触发条件**: 发现漏洞并开始修复
- **动画效果**:
  - 修复工具图标旋转
  - 修复进度条动画
  - 系统加固完成指示

#### 3. 攻击溯源动画 🔍
- **触发条件**: 开始分析攻击路径
- **动画效果**:
  - 分析图标放大效果
  - 攻击路径追踪线条
  - 攻击源标记显示

#### 4. 防火墙更新动画 🔄
- **触发条件**: 防火墙规则更新
- **动画效果**:
  - 更新指示器扩散
  - 规则更新文字提示

## 🏆 胜负判定系统

### 攻击方胜利条件
- ✅ 成功窃取核心数据且防御方未及时恢复
- ✅ 获得持久化控制且防御响应缓慢
- ✅ 在数据窃取前防御方未能阻断攻击

### 防御方胜利条件
- ✅ 成功阻断攻击并恢复所有系统
- ✅ 在数据窃取前成功阻断攻击
- ✅ 及时修复漏洞并完成系统加固

### 实时监控指标
- 📊 攻击进度跟踪（7个阶段）
- 🛡️ 防御行动跟踪（6个行动）
- 📈 资产状态统计（被攻陷 vs 已恢复）
- 🚫 威胁阻断统计（IP黑名单、规则更新）
- 🔒 安全加固统计（漏洞修复、系统恢复）

## 📊 战报系统

演练结束后，系统会自动生成详细战报，包含：

- ⏱️ **演练时长**: 从开始到结束的总时间
- 🎯 **攻击完成度**: 7个攻击阶段的完成情况
- 🛡️ **防御执行度**: 6个防御行动的执行情况
- 💥 **资产影响**: 被攻陷和已恢复的资产列表
- 🚫 **威胁处置**: 阻断的IP和更新的规则数量
- 🔒 **安全加固**: 修复的漏洞和加固的系统
- 🏆 **最终结果**: 攻击方胜利 / 防御方胜利

## 🧪 测试工具

### 系统测试脚本
```bash
python test_battle_system.py
```

该脚本会：
1. 检查所有服务的连接状态
2. 发送模拟的攻防消息
3. 验证防御可视化动画
4. 测试胜负判定系统
5. 验证战报生成功能

### 测试场景
- 🔍 **侦察阶段**: 网络扫描、端口探测
- 🛡️ **威胁阻断**: IP封锁、防火墙更新
- 🔧 **漏洞修复**: 补丁应用、系统加固
- 🎯 **攻击溯源**: 路径分析、证据收集
- 🏆 **胜负判定**: 防御方胜利场景
- 📊 **战报生成**: 详细统计报告

## 🔧 配置说明

### 环境变量配置
在 `agents/defense_agent/.env` 文件中配置：
```env
# WebSocket连接
BACKEND_WS_URL=ws://localhost:8080/ws/logs

# 防御智能体端口
THREAT_BLOCKING_PORT=8011
VULNERABILITY_AGENT_PORT=8012
ATTRIBUTION_AGENT_PORT=8013
```

### 胜负判定规则配置
在 `agents/defense_agent/battle_judge.py` 中可以调整：
- 攻击阶段权重
- 防御行动评分
- 胜利条件阈值
- 时间窗口限制

## 🐛 故障排除

### 常见问题

#### 1. WebSocket连接失败
```bash
# 检查后端服务是否启动
curl http://localhost:8080/health

# 检查端口占用
netstat -an | grep 8080
```

#### 2. 防御智能体无响应
```bash
# 检查防御智能体状态
curl http://localhost:8011/health
curl http://localhost:8012/health
curl http://localhost:8013/health
```

#### 3. 前端动画不显示
- 检查浏览器控制台错误
- 确认WebSocket连接正常
- 验证防御可视化初始化

#### 4. 胜负判定不准确
- 检查裁判系统日志
- 验证攻防进度统计
- 调整判定规则参数

### 日志查看
- **后端日志**: 控制台输出
- **防御智能体日志**: `agents/defense_agent/*.log`
- **前端日志**: 浏览器开发者工具
- **WebSocket消息**: 网络面板

## 📈 性能优化

### 系统性能建议
- **内存使用**: 建议至少4GB可用内存
- **CPU使用**: 多核心处理器，建议4核以上
- **网络延迟**: 本地部署，延迟 < 10ms
- **并发连接**: 支持多个WebSocket连接

### 动画性能优化
- 限制同时播放的动画数量
- 使用对象池减少内存分配
- 定期清理过期的动画对象
- 根据设备性能调整动画质量

## 🔄 版本更新

### v2.0 新特性
- ✅ 完整的防御可视化动画系统
- ✅ 实时胜负判定机制
- ✅ 详细战报生成功能
- ✅ 智能防御协调器
- ✅ 一键启动脚本
- ✅ 完整的测试工具

### 后续规划
- 🔄 多场景支持（金融、医疗、工业）
- 🔄 AI驱动的攻防策略优化
- 🔄 历史演练数据分析
- 🔄 团队协作模式
- 🔄 云端部署支持

## 📞 技术支持

如遇到问题，请：
1. 查看本文档的故障排除部分
2. 运行测试脚本验证系统状态
3. 检查相关日志文件
4. 提供详细的错误信息和复现步骤

---

🎯 **攻防演练系统** - 让网络安全训练更加直观和有效！