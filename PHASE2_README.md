# ç¬¬äºŒé˜¶æ®µå®ŒæˆæŠ¥å‘Šï¼šå‰ç«¯æ‹“æ‰‘å›¾é›†æˆå’Œäº¤äº’ä¼˜åŒ–

## ğŸ¯ é˜¶æ®µç›®æ ‡
âœ… **å·²å®Œæˆ** - é›†æˆapt-ready.ymlåœºæ™¯åˆ°å‰ç«¯ï¼Œå®ç°åŠé€æ˜æ‹“æ‰‘å›¾å±•ç¤ºã€èŠ‚ç‚¹åˆ é™¤/æ·»åŠ ã€è¿çº¿åŠŸèƒ½å’Œåœºæ™¯ç”ŸæˆæŒ‰é’®ã€‚

## ğŸ“ æ–°å¢å’Œä¿®æ”¹æ–‡ä»¶

```
src/views/user/Against/Topology/services/
â””â”€â”€ ScenarioDataService.js          # æ–°å¢ï¼šåœºæ™¯æ•°æ®æœåŠ¡

backend/main.py                     # ä¿®æ”¹ï¼šæ·»åŠ åœºæ™¯APIç«¯ç‚¹
src/views/user/Against/Create.vue   # ä¿®æ”¹ï¼šé›†æˆåœºæ™¯æ™ºèƒ½ä½“è°ƒç”¨
src/views/user/Against/Topology/TopologyView.vue  # ä¿®æ”¹ï¼šæ·»åŠ åœºæ™¯æ¨¡å¼æ”¯æŒ

test_phase2_frontend.py             # æ–°å¢ï¼šç¬¬äºŒé˜¶æ®µæµ‹è¯•è„šæœ¬
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. åœºæ™¯æ•°æ®æœåŠ¡ (ScenarioDataService.js)
**åŠŸèƒ½**:
- âœ… **APTåœºæ™¯æ•°æ®è·å–**: ä»åœºæ™¯æ™ºèƒ½ä½“è·å–apt-ready.ymlè§£æç»“æœ
- âœ… **æ•°æ®æ ¼å¼è½¬æ¢**: å°†åç«¯æ•°æ®è½¬æ¢ä¸ºå‰ç«¯æ‹“æ‰‘å›¾æ ¼å¼
- âœ… **èŠ‚ç‚¹ä½ç½®è®¡ç®—**: åŸºäºç½‘ç»œåˆ†ç»„å’ŒèŠ‚ç‚¹ç±»å‹æ™ºèƒ½å¸ƒå±€
- âœ… **æ ·å¼é…ç½®**: ä¸ºä¸åŒç±»å‹èŠ‚ç‚¹å’Œç½‘ç»œåˆ†é…é¢œè‰²å’Œå›¾æ ‡
- âœ… **æ¨¡æ‹Ÿæ•°æ®å¤‡é€‰**: æä¾›å¤‡é€‰æ•°æ®ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

**æ ¸å¿ƒæ–¹æ³•**:
```javascript
// è·å–APTåŒ»ç–—åœºæ™¯æ•°æ®
async getAptMedicalScenario()

// è½¬æ¢æ•°æ®æ ¼å¼
convertToTopologyFormat(scenarioTopology)

// è®¡ç®—èŠ‚ç‚¹ä½ç½®
calculateNodePosition(node, axis)

// è·å–æ ·å¼é…ç½®
getNodeColor(nodeType)
getNodeStrokeColor(status)
getConnectionColor(network)
```

### 2. åç«¯APIæ‰©å±• (backend/main.py)
**æ–°å¢ç«¯ç‚¹**:
- âœ… `GET /api/scenario/parse_apt_scenario` - è§£æAPTåœºæ™¯
- âœ… `POST /api/scenario/analyze_prompt` - åˆ†æåœºæ™¯æç¤ºè¯
- âœ… `POST /api/scenario/process_request` - ç»¼åˆåœºæ™¯å¤„ç†

**åŠŸèƒ½ç‰¹æ€§**:
- ä»£ç†è½¬å‘åˆ°åœºæ™¯æ™ºèƒ½ä½“ (ç«¯å£8007)
- ç»Ÿä¸€é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç ç®¡ç†
- è¶…æ—¶æ§åˆ¶å’Œè¿æ¥é‡è¯•æœºåˆ¶

### 3. å‰ç«¯æ‹“æ‰‘å›¾é›†æˆ (TopologyView.vue)
**åœºæ™¯æ¨¡å¼åŠŸèƒ½**:
- âœ… **åŠé€æ˜æ¸²æŸ“**: è™šæ‹ŸèŠ‚ç‚¹æ˜¾ç¤ºä¸ºåŠé€æ˜çŠ¶æ€
- âœ… **çŠ¶æ€åˆ‡æ¢**: æ”¯æŒè™šæ‹Ÿâ†’å¯åŠ¨ä¸­â†’è¿è¡Œä¸­â†’åœæ­¢çŠ¶æ€
- âœ… **ç¼–è¾‘æ¨¡å¼**: ä¸“é—¨çš„åœºæ™¯ç¼–è¾‘ç•Œé¢
- âœ… **èŠ‚ç‚¹æ“ä½œ**: åˆ é™¤ã€æ·»åŠ ã€è¿çº¿åŠŸèƒ½

**èŠ‚ç‚¹ç¼–è¾‘åŠŸèƒ½**:
```javascript
// åˆ é™¤èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ç›¸å…³è¿æ¥ï¼‰
deleteSelectedNode()

// æ·»åŠ æ–°èŠ‚ç‚¹
startAddingNode(nodeType)

// è¿æ¥èŠ‚ç‚¹
startConnectingNodes()

// çŠ¶æ€æ›´æ–°
updateNodeStatus(nodeId, newStatus)
```

**UIæ§ä»¶**:
- åœºæ™¯ç¼–è¾‘å·¥å…·æ 
- èŠ‚ç‚¹ç±»å‹é€‰æ‹©å™¨
- è¿æ¥æ¨¡å¼åˆ‡æ¢
- åœºæ™¯ä¿¡æ¯æ˜¾ç¤º

### 4. åœºæ™¯åˆ›å»ºæµç¨‹ä¼˜åŒ– (Create.vue)
**æµç¨‹æ”¹è¿›**:
- âœ… **ç»Ÿä¸€APIè°ƒç”¨**: ä½¿ç”¨ç»¼åˆåœºæ™¯å¤„ç†ç«¯ç‚¹
- âœ… **æ•°æ®ä¼ é€’**: é€šè¿‡sessionStorageä¼ é€’åœºæ™¯æ•°æ®
- âœ… **è·¯ç”±è·³è½¬**: å¸¦å‚æ•°è·³è½¬åˆ°æ‹“æ‰‘é¡µé¢
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤ºæœºåˆ¶

**æ•°æ®æµ**:
```
ç”¨æˆ·è¾“å…¥æç¤ºè¯ â†’ åœºæ™¯æ™ºèƒ½ä½“åˆ†æ â†’ sessionStorageå­˜å‚¨ â†’ æ‹“æ‰‘é¡µé¢åŠ è½½ â†’ åœºæ™¯æ¨¡å¼æ¿€æ´»
```

## ğŸ¨ ç”¨æˆ·ç•Œé¢è®¾è®¡

### åœºæ™¯æ¨¡å¼ç•Œé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ åœºæ™¯ç¼–è¾‘æ¨¡å¼                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ—‘ï¸ åˆ é™¤èŠ‚ç‚¹] [ğŸ”— è¿æ¥èŠ‚ç‚¹] [âŒ å–æ¶ˆè¿æ¥]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ·»åŠ èŠ‚ç‚¹:                                                   â”‚
â”‚ [å·¥ä½œç«™] [æœåŠ¡å™¨] [æ•°æ®åº“] [é˜²ç«å¢™] [è·¯ç”±å™¨] [äº¤æ¢æœº]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åœºæ™¯: APTåŒ»ç–—åœºæ™¯                                           â”‚
â”‚ èŠ‚ç‚¹æ•°: 12 | è™šæ‹ŸèŠ‚ç‚¹: 12 | è¿è¡ŒèŠ‚ç‚¹: 0                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‹“æ‰‘å›¾çŠ¶æ€
- **è™šæ‹ŸèŠ‚ç‚¹**: åŠé€æ˜ + è™šçº¿è¾¹æ¡† (opacity: 0.5, strokeDashArray: [5,5])
- **å¯åŠ¨ä¸­**: æ©™è‰²è¾¹æ¡† + ç‚¹çº¿ (stroke: #f39c12, strokeDashArray: [3,3])
- **è¿è¡Œä¸­**: ç»¿è‰²è¾¹æ¡† + å®çº¿ (stroke: #27ae60, opacity: 1.0)
- **å·²åœæ­¢**: çº¢è‰²è¾¹æ¡† + è™šçº¿ (stroke: #e74c3c, strokeDashArray: [5,5])

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´åœºæ™¯åˆ›å»ºæµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·åœ¨Createé¡µé¢è¾“å…¥æç¤ºè¯] --> B[è°ƒç”¨åœºæ™¯æ™ºèƒ½ä½“API]
    B --> C[åœºæ™¯æ™ºèƒ½ä½“åˆ†ææç¤ºè¯]
    C --> D[è¿”å›åœºæ™¯æ•°æ®]
    D --> E[å­˜å‚¨åˆ°sessionStorage]
    E --> F[è·³è½¬åˆ°æ‹“æ‰‘é¡µé¢]
    F --> G[æ£€æµ‹åœºæ™¯æ¨¡å¼å‚æ•°]
    G --> H[åŠ è½½APTåŒ»ç–—åœºæ™¯]
    H --> I[æ¸²æŸ“åŠé€æ˜æ‹“æ‰‘å›¾]
    I --> J[å¯ç”¨ç¼–è¾‘æ¨¡å¼]
    J --> K[ç”¨æˆ·ç¼–è¾‘æ‹“æ‰‘ç»“æ„]
    K --> L[ç‚¹å‡»ç”Ÿæˆåœºæ™¯æŒ‰é’®]
    L --> M[å¯åŠ¨å®¹å™¨]
    M --> N[èŠ‚ç‚¹å˜ä¸ºå®ä½“çŠ¶æ€]
```

### èŠ‚ç‚¹ç¼–è¾‘æµç¨‹
```mermaid
graph TD
    A[é€‰æ‹©ç¼–è¾‘æ“ä½œ] --> B{æ“ä½œç±»å‹}
    B -->|åˆ é™¤| C[é€‰æ‹©èŠ‚ç‚¹] --> D[ç¡®è®¤åˆ é™¤] --> E[åˆ é™¤èŠ‚ç‚¹å’Œè¿æ¥]
    B -->|æ·»åŠ | F[é€‰æ‹©èŠ‚ç‚¹ç±»å‹] --> G[ç‚¹å‡»ç”»å¸ƒä½ç½®] --> H[åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹]
    B -->|è¿æ¥| I[é€‰æ‹©ç¬¬ä¸€ä¸ªèŠ‚ç‚¹] --> J[é€‰æ‹©ç¬¬äºŒä¸ªèŠ‚ç‚¹] --> K[åˆ›å»ºè¿æ¥çº¿]
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬ (test_phase2_frontend.py)
**æµ‹è¯•è¦†ç›–**:
- âœ… åç«¯åœºæ™¯APIåŠŸèƒ½
- âœ… åœºæ™¯æ•°æ®æœåŠ¡è½¬æ¢
- âœ… æç¤ºè¯åˆ†æå‡†ç¡®æ€§
- âœ… ç»¼åˆåœºæ™¯å¤„ç†æµç¨‹
- âœ… å‰ç«¯é›†æˆå®Œæ•´æ€§

**è¿è¡Œæµ‹è¯•**:
```bash
python test_phase2_frontend.py
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤
1. **åœºæ™¯åˆ›å»ºæµ‹è¯•**:
   - è®¿é—® `/against/create`
   - è¾“å…¥: "åŒ»ç–—æœºæ„é­å—APTæ”»å‡»"
   - ç‚¹å‡»"ç”Ÿæˆåœºæ™¯"
   - éªŒè¯è·³è½¬åˆ°æ‹“æ‰‘é¡µé¢

2. **åœºæ™¯ç¼–è¾‘æµ‹è¯•**:
   - éªŒè¯åŠé€æ˜èŠ‚ç‚¹æ˜¾ç¤º
   - æµ‹è¯•èŠ‚ç‚¹åˆ é™¤åŠŸèƒ½
   - æµ‹è¯•èŠ‚ç‚¹æ·»åŠ åŠŸèƒ½
   - æµ‹è¯•èŠ‚ç‚¹è¿æ¥åŠŸèƒ½

3. **åœºæ™¯ç”Ÿæˆæµ‹è¯•**:
   - ç‚¹å‡»"ç”Ÿæˆåœºæ™¯"æŒ‰é’®
   - éªŒè¯å®¹å™¨å¯åŠ¨
   - éªŒè¯èŠ‚ç‚¹çŠ¶æ€å˜åŒ–

## ğŸ“Š æ•°æ®ç»“æ„

### åœºæ™¯æ•°æ®æ ¼å¼
```javascript
{
  nodes: [
    {
      id: "service_name",
      name: "display_name",
      type: "firewall|database|workstation|...",
      x: 300, y: 200,
      networks: ["network1", "network2"],
      ipAddresses: {"network1": "192.168.1.10"},
      status: "virtual|starting|running|stopped",
      // æ¸²æŸ“å±æ€§
      fill: "#e74c3c",
      stroke: "#bdc3c7",
      opacity: 0.5,
      strokeDashArray: [5, 5]
    }
  ],
  connections: [
    {
      id: "node1-node2",
      source: "node1",
      target: "node2",
      network: "shared_network",
      stroke: "#95a5a6",
      opacity: 0.7
    }
  ],
  networks: [
    {
      id: "network_name",
      subnet: "192.168.1.0/24",
      color: "#4ecdc4"
    }
  ]
}
```

## ğŸ¯ å…³é”®æŠ€æœ¯å®ç°

### 1. åŠé€æ˜æ¸²æŸ“
```javascript
// è™šæ‹ŸèŠ‚ç‚¹æ ·å¼
const virtualNodeStyle = {
  opacity: 0.5,
  strokeDashArray: [5, 5],
  stroke: '#bdc3c7'
}

// å®ä½“èŠ‚ç‚¹æ ·å¼
const runningNodeStyle = {
  opacity: 1.0,
  strokeDashArray: [],
  stroke: '#27ae60'
}
```

### 2. èŠ‚ç‚¹ä½ç½®è®¡ç®—
```javascript
calculateNodePosition(node, axis) {
  // åŸºäºç½‘ç»œåˆ†ç»„
  const networkPositions = {
    dmz_segment: { x: 300, y: 200 },
    user_segment: { x: 500, y: 300 },
    server_segment: { x: 700, y: 200 }
  }
  
  // åŸºäºèŠ‚ç‚¹ç±»å‹å¾®è°ƒ
  const typeOffsets = {
    firewall: { x: 0, y: -50 },
    workstation: { x: 50, y: 50 }
  }
}
```

### 3. çŠ¶æ€ç®¡ç†
```javascript
// åœºæ™¯æ¨¡å¼çŠ¶æ€
const isScenarioMode = ref(false)
const virtualNodes = ref(new Set())
const runningNodes = ref(new Set())

// ç¼–è¾‘æ¨¡å¼çŠ¶æ€
const isEditMode = ref(false)
const isAddingNode = ref(false)
const isConnectingNodes = ref(false)
```

## âœ… ç¬¬äºŒé˜¶æ®µéªŒæ”¶æ ‡å‡†

- [x] èƒ½æ˜¾ç¤ºåŠé€æ˜çš„è™šæ‹Ÿæ‹“æ‰‘å›¾
- [x] æ”¯æŒèŠ‚ç‚¹åˆ é™¤ï¼ˆåŒ…æ‹¬è¿çº¿ï¼‰
- [x] æ”¯æŒä»è®¾å¤‡åº“æ·»åŠ æ–°èŠ‚ç‚¹
- [x] æ”¯æŒèŠ‚ç‚¹é—´è¿çº¿æ“ä½œ
- [x] ç‚¹å‡»"ç”Ÿæˆåœºæ™¯"åèŠ‚ç‚¹å˜ä¸ºå®ä½“çŠ¶æ€
- [x] åœºæ™¯æ•°æ®æ­£ç¡®é›†æˆåˆ°å‰ç«¯
- [x] ç”¨æˆ·ç•Œé¢å‹å¥½ä¸”åŠŸèƒ½å®Œæ•´
- [x] æä¾›å®Œæ•´çš„æµ‹è¯•éªŒè¯æ–¹æ¡ˆ

## ğŸš€ ä¸‹ä¸€é˜¶æ®µé¢„è§ˆ

**ç¬¬ä¸‰é˜¶æ®µ**: åç«¯å®¹å™¨ç¼–æ’æœåŠ¡æ‰©å±•
- æ‰©å±•æ‹“æ‰‘ç®¡ç†APIæ”¯æŒapt-ready.yml
- å®ç°å®¹å™¨çŠ¶æ€ä¸å‰ç«¯èŠ‚ç‚¹çš„å®æ—¶æ˜ å°„
- æ·»åŠ åœºæ™¯è§£æå’Œéƒ¨ç½²æœåŠ¡
- å®Œå–„å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

**ğŸ‰ ç¬¬äºŒé˜¶æ®µåœ†æ»¡å®Œæˆï¼å‰ç«¯å·²å…·å¤‡å®Œæ•´çš„åœºæ™¯ç¼–è¾‘å’Œå¯è§†åŒ–èƒ½åŠ›ã€‚**
