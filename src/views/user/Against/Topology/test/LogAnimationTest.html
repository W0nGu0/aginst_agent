<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¿—åŠ¨ç”»æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-panel {
            background: rgba(30, 30, 47, 0.8);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .log-display {
            background: #000;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #333;
        }
        .log-info { border-left-color: #3b82f6; }
        .log-success { border-left-color: #10b981; }
        .log-warning { border-left-color: #f59e0b; }
        .log-error { border-left-color: #dc2626; }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .btn-info { background: #2196F3; color: white; }
        .btn-warning { background: #ff9800; color: white; }
        .btn:hover { opacity: 0.8; transform: translateY(-2px); }
        
        .stage-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ æ—¥å¿—åŠ¨ç”»æµ‹è¯•ç³»ç»Ÿ</h1>
        
        <div class="stage-info">
            <h3>å½“å‰æ”»å‡»é˜¶æ®µ: <span id="current-stage">æœªå¼€å§‹</span></h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p>è¿›åº¦: <span id="progress-text">0%</span></p>
        </div>

        <div class="test-panel">
            <h3>ğŸ® æµ‹è¯•æ§åˆ¶</h3>
            <div class="controls">
                <button class="btn btn-primary" onclick="startFullAttackSequence()">å®Œæ•´æ”»å‡»åºåˆ—</button>
                <button class="btn btn-info" onclick="testReconnaissance()">ä¾¦å¯Ÿé˜¶æ®µ</button>
                <button class="btn btn-info" onclick="testWeaponization()">æ­¦å™¨åŒ–é˜¶æ®µ</button>
                <button class="btn btn-info" onclick="testDelivery()">æŠ•é€’é˜¶æ®µ</button>
                <button class="btn btn-warning" onclick="testExploitation()">åˆ©ç”¨é˜¶æ®µ</button>
                <button class="btn btn-warning" onclick="testInstallation()">å®‰è£…é˜¶æ®µ</button>
                <button class="btn btn-warning" onclick="testCommandControl()">å‘½ä»¤æ§åˆ¶</button>
                <button class="btn btn-primary" onclick="testActions()">è¡ŒåŠ¨ç›®æ ‡</button>
                <button class="btn btn-danger" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
            </div>
        </div>

        <div class="test-panel">
            <h3>ğŸ“‹ æ¨¡æ‹Ÿæ—¥å¿—è¾“å‡º</h3>
            <div class="log-display" id="log-display">
                <div class="log-entry log-info">
                    <strong>[ç³»ç»Ÿ]</strong> æ—¥å¿—åŠ¨ç”»æµ‹è¯•ç³»ç»Ÿå·²å¯åŠ¨
                </div>
            </div>
        </div>

        <div class="test-panel">
            <h3>ğŸ“Š åŠ¨ç”»äº‹ä»¶ç»Ÿè®¡</h3>
            <div id="animation-stats">
                <p>è§¦å‘çš„åŠ¨ç”»äº‹ä»¶: <span id="event-count">0</span></p>
                <p>å½“å‰æ´»è·ƒåŠ¨ç”»: <span id="active-animations">0</span></p>
                <p>æœ€åè§¦å‘æ—¶é—´: <span id="last-trigger">-</span></p>
            </div>
        </div>
    </div>

    <script>
        let eventCount = 0;
        let currentProgress = 0;
        let attackSequenceRunning = false;

        // æ”»å‡»é˜¶æ®µå®šä¹‰
        const attackStages = {
            reconnaissance: { name: 'ä¾¦å¯Ÿé˜¶æ®µ', color: '#3b82f6' },
            weaponization: { name: 'æ­¦å™¨åŒ–é˜¶æ®µ', color: '#10b981' },
            delivery: { name: 'æŠ•é€’é˜¶æ®µ', color: '#f59e0b' },
            exploitation: { name: 'åˆ©ç”¨é˜¶æ®µ', color: '#dc2626' },
            installation: { name: 'å®‰è£…é˜¶æ®µ', color: '#8b5cf6' },
            command_and_control: { name: 'å‘½ä»¤æ§åˆ¶é˜¶æ®µ', color: '#6366f1' },
            actions_on_objectives: { name: 'è¡ŒåŠ¨ç›®æ ‡é˜¶æ®µ', color: '#059669' }
        };

        // æ¨¡æ‹Ÿæ—¥å¿—æ¡ç›®
        const sampleLogs = {
            reconnaissance: [
                {
                    level: 'info',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: '[ä¾¦å¯Ÿé˜¶æ®µ] å¼€å§‹å¯¹ç›®æ ‡ç½‘ç»œè¿›è¡Œç«¯å£æ‰«æ',
                    attack_info: {
                        stage: 'reconnaissance',
                        technique: 'port_scan',
                        source_node: 'internet',
                        target_node: 'firewall',
                        status: 'starting',
                        progress: 10
                    }
                },
                {
                    level: 'info',
                    source: 'æ‰«æå™¨',
                    message: 'å‘ç°é˜²ç«å¢™å¼€æ”¾ç«¯å£: 80, 443, 22',
                    attack_info: {
                        stage: 'reconnaissance',
                        technique: 'port_scan',
                        target_node: 'firewall',
                        status: 'in_progress',
                        progress: 25
                    }
                },
                {
                    level: 'success',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: 'ä¾¦å¯Ÿé˜¶æ®µå®Œæˆï¼Œæ”¶é›†åˆ°ç›®æ ‡ç½‘ç»œæ‹“æ‰‘ä¿¡æ¯',
                    attack_info: {
                        stage: 'reconnaissance',
                        technique: 'info_gathering',
                        status: 'completed',
                        progress: 30
                    }
                }
            ],
            weaponization: [
                {
                    level: 'info',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: '[æ­¦å™¨åŒ–é˜¶æ®µ] å¼€å§‹ç”Ÿæˆé’ˆå¯¹æ€§é’“é±¼é‚®ä»¶',
                    attack_info: {
                        stage: 'weaponization',
                        technique: 'phishing_email',
                        status: 'starting',
                        progress: 35
                    }
                },
                {
                    level: 'info',
                    source: 'æ­¦å™¨ç”Ÿæˆå™¨',
                    message: 'æ­£åœ¨åˆ†æç›®æ ‡å‘˜å·¥ç¤¾äº¤åª’ä½“ä¿¡æ¯...',
                    attack_info: {
                        stage: 'weaponization',
                        technique: 'phishing_email',
                        status: 'in_progress',
                        progress: 45
                    }
                },
                {
                    level: 'success',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: 'é’“é±¼é‚®ä»¶ç”Ÿæˆå®Œæˆï¼ŒåŒ…å«æ¶æ„é™„ä»¶',
                    attack_info: {
                        stage: 'weaponization',
                        technique: 'phishing_email',
                        status: 'completed',
                        progress: 50
                    }
                }
            ],
            delivery: [
                {
                    level: 'info',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: '[æŠ•é€’é˜¶æ®µ] å¼€å§‹å‘é€é’“é±¼é‚®ä»¶åˆ°ç›®æ ‡å‘˜å·¥',
                    attack_info: {
                        stage: 'delivery',
                        technique: 'email_delivery',
                        source_node: 'internet',
                        target_node: 'target_host',
                        status: 'starting',
                        progress: 55
                    }
                },
                {
                    level: 'success',
                    source: 'é‚®ä»¶æœåŠ¡å™¨',
                    message: 'é’“é±¼é‚®ä»¶å·²æˆåŠŸæŠ•é€’åˆ°ç›®æ ‡é‚®ç®±',
                    attack_info: {
                        stage: 'delivery',
                        technique: 'email_delivery',
                        target_node: 'target_host',
                        status: 'completed',
                        progress: 60
                    }
                }
            ],
            exploitation: [
                {
                    level: 'warning',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: '[åˆ©ç”¨é˜¶æ®µ] ç›®æ ‡ç”¨æˆ·ç‚¹å‡»äº†é’“é±¼é‚®ä»¶é“¾æ¥',
                    attack_info: {
                        stage: 'exploitation',
                        technique: 'credential_theft',
                        target_node: 'target_host',
                        status: 'starting',
                        progress: 65
                    }
                },
                {
                    level: 'success',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: 'æˆåŠŸçªƒå–ç”¨æˆ·å‡­æ®ï¼Œè·å¾—åˆå§‹è®¿é—®æƒé™',
                    attack_info: {
                        stage: 'exploitation',
                        technique: 'credential_theft',
                        target_node: 'target_host',
                        status: 'completed',
                        progress: 70
                    }
                }
            ],
            installation: [
                {
                    level: 'info',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: '[å®‰è£…é˜¶æ®µ] åœ¨ç›®æ ‡ç³»ç»Ÿå®‰è£…åé—¨ç¨‹åº',
                    attack_info: {
                        stage: 'installation',
                        technique: 'backdoor_install',
                        target_node: 'target_host',
                        status: 'starting',
                        progress: 75
                    }
                },
                {
                    level: 'success',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: 'åé—¨å®‰è£…æˆåŠŸï¼Œå»ºç«‹æŒä¹…åŒ–è®¿é—®',
                    attack_info: {
                        stage: 'installation',
                        technique: 'persistence_mechanism',
                        target_node: 'target_host',
                        status: 'completed',
                        progress: 80
                    }
                }
            ],
            command_and_control: [
                {
                    level: 'info',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: '[å‘½ä»¤æ§åˆ¶] å»ºç«‹C2é€šä¿¡ä¿¡é“',
                    attack_info: {
                        stage: 'command_and_control',
                        technique: 'c2_communication',
                        source_node: 'internet',
                        target_node: 'target_host',
                        status: 'starting',
                        progress: 85
                    }
                },
                {
                    level: 'info',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: 'å¼€å§‹æ¨ªå‘ç§»åŠ¨ï¼Œæ¢æµ‹å†…ç½‘å…¶ä»–ç³»ç»Ÿ',
                    attack_info: {
                        stage: 'command_and_control',
                        technique: 'lateral_movement',
                        source_node: 'target_host',
                        target_node: 'internal-db',
                        status: 'in_progress',
                        progress: 90
                    }
                }
            ],
            actions_on_objectives: [
                {
                    level: 'warning',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: '[è¡ŒåŠ¨ç›®æ ‡] å¼€å§‹çªƒå–æ•æ„Ÿæ•°æ®',
                    attack_info: {
                        stage: 'actions_on_objectives',
                        technique: 'data_theft',
                        source_node: 'internal-db',
                        target_node: 'internet',
                        status: 'starting',
                        progress: 95
                    }
                },
                {
                    level: 'success',
                    source: 'æ”»å‡»æ™ºèƒ½ä½“',
                    message: 'æ”»å‡»ç›®æ ‡è¾¾æˆï¼æˆåŠŸçªƒå–å®¢æˆ·æ•°æ®åº“',
                    attack_info: {
                        stage: 'actions_on_objectives',
                        technique: 'system_compromise',
                        target_node: 'internal-db',
                        status: 'completed',
                        progress: 100
                    }
                }
            ]
        };

        // æ·»åŠ æ—¥å¿—æ¡ç›®åˆ°æ˜¾ç¤ºåŒºåŸŸ
        function addLogEntry(log) {
            const logDisplay = document.getElementById('log-display');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${log.level}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logEntry.innerHTML = `
                <strong>[${timestamp}] [${log.source}]</strong> ${log.message}
                ${log.attack_info ? `<br><small>é˜¶æ®µ: ${log.attack_info.stage} | æŠ€æœ¯: ${log.attack_info.technique} | è¿›åº¦: ${log.attack_info.progress}%</small>` : ''}
            `;
            
            logDisplay.appendChild(logEntry);
            logDisplay.scrollTop = logDisplay.scrollHeight;
            
            // è§¦å‘åŠ¨ç”»äº‹ä»¶
            triggerAnimationEvent(log);
            
            // æ›´æ–°è¿›åº¦
            if (log.attack_info && log.attack_info.progress) {
                updateProgress(log.attack_info.stage, log.attack_info.progress);
            }
        }

        // è§¦å‘åŠ¨ç”»äº‹ä»¶
        function triggerAnimationEvent(log) {
            eventCount++;
            
            // åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶
            const event = new CustomEvent('topology-animation', {
                detail: {
                    type: 'attack_step',
                    attackInfo: log.attack_info,
                    log: log
                }
            });
            
            // è§¦å‘äº‹ä»¶
            document.dispatchEvent(event);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            console.log('ğŸ¬ è§¦å‘åŠ¨ç”»äº‹ä»¶:', log);
        }

        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress(stage, progress) {
            const stageElement = document.getElementById('current-stage');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            if (attackStages[stage]) {
                stageElement.textContent = attackStages[stage].name;
                stageElement.style.color = attackStages[stage].color;
            }
            
            progressFill.style.width = progress + '%';
            progressText.textContent = progress + '%';
            currentProgress = progress;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('event-count').textContent = eventCount;
            document.getElementById('last-trigger').textContent = new Date().toLocaleTimeString();
            // æ¨¡æ‹Ÿæ´»è·ƒåŠ¨ç”»æ•°é‡
            document.getElementById('active-animations').textContent = Math.floor(Math.random() * 5) + 1;
        }

        // æµ‹è¯•å‡½æ•°
        function testReconnaissance() {
            sampleLogs.reconnaissance.forEach((log, index) => {
                setTimeout(() => addLogEntry(log), index * 1000);
            });
        }

        function testWeaponization() {
            sampleLogs.weaponization.forEach((log, index) => {
                setTimeout(() => addLogEntry(log), index * 1500);
            });
        }

        function testDelivery() {
            sampleLogs.delivery.forEach((log, index) => {
                setTimeout(() => addLogEntry(log), index * 1000);
            });
        }

        function testExploitation() {
            sampleLogs.exploitation.forEach((log, index) => {
                setTimeout(() => addLogEntry(log), index * 1200);
            });
        }

        function testInstallation() {
            sampleLogs.installation.forEach((log, index) => {
                setTimeout(() => addLogEntry(log), index * 1500);
            });
        }

        function testCommandControl() {
            sampleLogs.command_and_control.forEach((log, index) => {
                setTimeout(() => addLogEntry(log), index * 2000);
            });
        }

        function testActions() {
            sampleLogs.actions_on_objectives.forEach((log, index) => {
                setTimeout(() => addLogEntry(log), index * 1500);
            });
        }

        // å®Œæ•´æ”»å‡»åºåˆ—
        function startFullAttackSequence() {
            if (attackSequenceRunning) {
                addLogEntry({
                    level: 'warning',
                    source: 'ç³»ç»Ÿ',
                    message: 'æ”»å‡»åºåˆ—å·²åœ¨è¿è¡Œä¸­...'
                });
                return;
            }
            
            attackSequenceRunning = true;
            clearLogs();
            
            addLogEntry({
                level: 'info',
                source: 'ç³»ç»Ÿ',
                message: 'ğŸš€ å¼€å§‹å®Œæ•´æ”»å‡»åºåˆ—æ¼”ç¤º'
            });
            
            let delay = 1000;
            
            // ä¾æ¬¡æ‰§è¡Œå„ä¸ªé˜¶æ®µ
            Object.keys(sampleLogs).forEach((stage, stageIndex) => {
                sampleLogs[stage].forEach((log, logIndex) => {
                    setTimeout(() => {
                        addLogEntry(log);
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªæ—¥å¿—
                        if (stageIndex === Object.keys(sampleLogs).length - 1 && 
                            logIndex === sampleLogs[stage].length - 1) {
                            setTimeout(() => {
                                addLogEntry({
                                    level: 'success',
                                    source: 'ç³»ç»Ÿ',
                                    message: 'ğŸ‰ å®Œæ•´æ”»å‡»åºåˆ—æ¼”ç¤ºå®Œæˆï¼'
                                });
                                attackSequenceRunning = false;
                            }, 2000);
                        }
                    }, delay);
                    delay += 1500;
                });
                delay += 1000; // é˜¶æ®µé—´é¢å¤–å»¶è¿Ÿ
            });
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            const logDisplay = document.getElementById('log-display');
            logDisplay.innerHTML = '<div class="log-entry log-info"><strong>[ç³»ç»Ÿ]</strong> æ—¥å¿—å·²æ¸…é™¤</div>';
            
            // é‡ç½®è¿›åº¦
            updateProgress('', 0);
            document.getElementById('current-stage').textContent = 'æœªå¼€å§‹';
            document.getElementById('current-stage').style.color = 'white';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            addLogEntry({
                level: 'success',
                source: 'ç³»ç»Ÿ',
                message: 'ğŸ“¡ æ—¥å¿—åŠ¨ç”»æµ‹è¯•ç³»ç»Ÿå·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•'
            });
            
            // ç›‘å¬åŠ¨ç”»äº‹ä»¶ï¼ˆç”¨äºè°ƒè¯•ï¼‰
            document.addEventListener('topology-animation', (event) => {
                console.log('ğŸ¯ åŠ¨ç”»äº‹ä»¶å·²è§¦å‘:', event.detail);
            });
        });
    </script>
</body>
</html>
