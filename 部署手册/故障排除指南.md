# æ•…éšœæ’é™¤æŒ‡å—

æœ¬æ–‡æ¡£æä¾›å¸¸è§é—®é¢˜çš„è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè§£å†³éƒ¨ç½²å’Œè¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚

## ğŸ” é—®é¢˜è¯Šæ–­æµç¨‹

### 1. åŸºç¡€æ£€æŸ¥
```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
df -h          # ç£ç›˜ç©ºé—´
free -h        # å†…å­˜ä½¿ç”¨
top            # CPUä½¿ç”¨

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping google.com
curl -I http://localhost:8080
```

### 2. æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8080  # Linux
netstat -ano | findstr :8080 # Windows

# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
ps aux | grep python  # Linux
tasklist | findstr python  # Windows
```

## âŒ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### 1. ä¾èµ–å®‰è£…é—®é¢˜

#### é”™è¯¯: npm install å¤±è´¥
```
npm ERR! network request failed
npm ERR! network This is a problem related to network connectivity
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ–¹æ¡ˆ1: æ¸…é™¤npmç¼“å­˜
npm cache clean --force
rm -rf node_modules package-lock.json
npm install

# æ–¹æ¡ˆ2: ä½¿ç”¨å›½å†…é•œåƒæº
npm config set registry https://registry.npmmirror.com/
npm install

# æ–¹æ¡ˆ3: ä½¿ç”¨yarnæ›¿ä»£
npm install -g yarn
yarn install
```

#### é”™è¯¯: pip install å¤±è´¥
```
ERROR: Could not install packages due to an EnvironmentError
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ–¹æ¡ˆ1: å‡çº§pip
python -m pip install --upgrade pip

# æ–¹æ¡ˆ2: ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# æ–¹æ¡ˆ3: ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate     # Windows
pip install -r requirements.txt
```

### 2. ç«¯å£å ç”¨é—®é¢˜

#### é”™è¯¯: ç«¯å£å·²è¢«å ç”¨
```
Error: listen EADDRINUSE: address already in use :::8080
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
# Linux/macOS
lsof -i :8080
netstat -tulpn | grep :8080

# Windows
netstat -ano | findstr :8080

# ç»ˆæ­¢è¿›ç¨‹
kill -9 <PID>        # Linux/macOS
taskkill /PID <PID> /F  # Windows

# æˆ–è€…ä¿®æ”¹é…ç½®ä½¿ç”¨å…¶ä»–ç«¯å£
# åœ¨ backend/.env ä¸­è®¾ç½®: PORT=8081
```

### 3. APIå¯†é’¥é—®é¢˜

#### é”™è¯¯: DeepSeek APIè°ƒç”¨å¤±è´¥
```
Error: Invalid API key provided
```

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®
```bash
cat agents/scenario_agent/.env
```

2. éªŒè¯APIå¯†é’¥æ ¼å¼
```env
# æ­£ç¡®æ ¼å¼
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# é”™è¯¯æ ¼å¼ (ç¼ºå°‘sk-å‰ç¼€)
DEEPSEEK_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

3. æµ‹è¯•APIè¿æ¥
```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{"model":"deepseek-chat","messages":[{"role":"user","content":"Hello"}]}' \
     https://api.deepseek.com/v1/chat/completions
```

### 4. Dockerç›¸å…³é—®é¢˜

#### é”™è¯¯: Docker daemonæœªè¿è¡Œ
```
Cannot connect to the Docker daemon at unix:///var/run/docker.sock
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# Linux
sudo systemctl start docker
sudo systemctl enable docker

# Windows/macOS
# å¯åŠ¨Docker Desktopåº”ç”¨ç¨‹åº

# éªŒè¯DockerçŠ¶æ€
docker info
```

#### é”™è¯¯: Dockeré•œåƒæ„å»ºå¤±è´¥
```
ERROR: failed to solve: process "/bin/sh -c apt-get update" did not complete successfully
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ¸…ç†Dockerç¼“å­˜
docker system prune -a

# é‡æ–°æ„å»ºé•œåƒ
docker build --no-cache -t sec-agent/ubuntu ./docker/images/ubuntu

# æ£€æŸ¥Dockerfileè¯­æ³•
docker build --dry-run -t test ./docker/images/ubuntu
```

### 5. å‰ç«¯æ„å»ºé—®é¢˜

#### é”™è¯¯: Viteæ„å»ºå¤±è´¥
```
Error: Build failed with 1 error:
node_modules/some-package/index.js:1:0: ERROR: Top-level await is not available
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ›´æ–°Node.jsç‰ˆæœ¬ (éœ€è¦16+)
node --version

# æ¸…é™¤ç¼“å­˜é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install

# æ£€æŸ¥vite.config.jsé…ç½®
npm run build -- --debug
```

### 6. åç«¯æœåŠ¡é—®é¢˜

#### é”™è¯¯: FastAPIå¯åŠ¨å¤±è´¥
```
ImportError: No module named 'fastapi'
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥Pythonç¯å¢ƒ
which python
python --version

# é‡æ–°å®‰è£…ä¾èµ–
cd backend
pip install -r requirements.txt

# æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

#### é”™è¯¯: æ•°æ®åº“è¿æ¥å¤±è´¥
```
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) unable to open database file
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la app.db

# åˆ›å»ºæ•°æ®åº“ç›®å½•
mkdir -p data
chmod 755 data

# æ£€æŸ¥æ•°æ®åº“URLé…ç½®
echo $DATABASE_URL
```

## ğŸ”§ æ€§èƒ½é—®é¢˜è¯Šæ–­

### 1. å†…å­˜ä½¿ç”¨è¿‡é«˜

**è¯Šæ–­:**
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
ps aux --sort=-%mem | head

# æ£€æŸ¥Pythonè¿›ç¨‹å†…å­˜
ps -p <PID> -o pid,vsz,rss,comm
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# é™åˆ¶Pythonå†…å­˜ä½¿ç”¨
export PYTHONMALLOC=malloc
ulimit -v 2097152  # é™åˆ¶ä¸º2GB

# ä¼˜åŒ–ä»£ç 
# åœ¨agentsé…ç½®ä¸­å‡å°‘MAX_TOKENS
MAX_TOKENS=2000
```

### 2. CPUä½¿ç”¨è¿‡é«˜

**è¯Šæ–­:**
```bash
# æ£€æŸ¥CPUä½¿ç”¨
top -p <PID>
htop

# æ£€æŸ¥è¿›ç¨‹çº¿ç¨‹
ps -T -p <PID>
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# é™åˆ¶å¹¶å‘è¯·æ±‚
# åœ¨backend/.envä¸­è®¾ç½®
RATE_LIMIT=50
MAX_WORKERS=4
```

### 3. ç½‘ç»œå»¶è¿Ÿé—®é¢˜

**è¯Šæ–­:**
```bash
# æµ‹è¯•APIå“åº”æ—¶é—´
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:8080/health

# åˆ›å»ºcurl-format.txt
echo "time_total: %{time_total}\ntime_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}" > curl-format.txt
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# ä¼˜åŒ–APIè¶…æ—¶è®¾ç½®
TIMEOUT=10
MAX_RETRIES=2

# å¯ç”¨è¿æ¥æ± 
KEEP_ALIVE=True
CONNECTION_POOL_SIZE=20
```

## ğŸ“‹ æ—¥å¿—åˆ†æ

### 1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# åç«¯æœåŠ¡æ—¥å¿—
tail -f backend/logs/app.log

# åœºæ™¯æ™ºèƒ½ä½“æ—¥å¿—
tail -f agents/scenario_agent/logs/agent.log

# ç³»ç»Ÿæ—¥å¿—
journalctl -u docker  # Linux
```

### 2. å¸¸è§æ—¥å¿—é”™è¯¯

#### è¿æ¥è¶…æ—¶
```
TimeoutError: Request timeout after 30 seconds
```
**è§£å†³:** å¢åŠ TIMEOUTé…ç½®å€¼

#### APIé…é¢è¶…é™
```
RateLimitError: Rate limit exceeded
```
**è§£å†³:** æ£€æŸ¥APIä½¿ç”¨é‡ï¼Œè€ƒè™‘å‡çº§å¥—é¤

#### å†…å­˜ä¸è¶³
```
MemoryError: Unable to allocate memory
```
**è§£å†³:** å¢åŠ ç³»ç»Ÿå†…å­˜æˆ–ä¼˜åŒ–ä»£ç 

## ğŸ› ï¸ è°ƒè¯•å·¥å…·

### 1. å¥åº·æ£€æŸ¥è„šæœ¬

åˆ›å»º `debug_health.py`:
```python
#!/usr/bin/env python3
import requests
import sys

def check_service(name, url):
    try:
        response = requests.get(url, timeout=5)
        if response.status_code == 200:
            print(f"âœ… {name}: OK")
            return True
        else:
            print(f"âŒ {name}: HTTP {response.status_code}")
            return False
    except Exception as e:
        print(f"âŒ {name}: {e}")
        return False

services = [
    ("å‰ç«¯", "http://localhost:5173"),
    ("åç«¯", "http://localhost:8080/health"),
    ("åœºæ™¯æœåŠ¡", "http://localhost:8002/health"),
    ("åœºæ™¯æ™ºèƒ½ä½“", "http://localhost:8007/health"),
]

all_ok = True
for name, url in services:
    if not check_service(name, url):
        all_ok = False

sys.exit(0 if all_ok else 1)
```

### 2. ç¯å¢ƒæ£€æŸ¥è„šæœ¬

åˆ›å»º `debug_env.py`:
```python
#!/usr/bin/env python3
import os
import sys
from pathlib import Path

def check_file(path, required=True):
    if Path(path).exists():
        print(f"âœ… {path}: å­˜åœ¨")
        return True
    else:
        status = "âŒ" if required else "âš ï¸"
        print(f"{status} {path}: ä¸å­˜åœ¨")
        return not required

def check_env_var(var, required=True):
    value = os.getenv(var)
    if value:
        print(f"âœ… {var}: å·²è®¾ç½®")
        return True
    else:
        status = "âŒ" if required else "âš ï¸"
        print(f"{status} {var}: æœªè®¾ç½®")
        return not required

# æ£€æŸ¥å¿…éœ€æ–‡ä»¶
files_ok = all([
    check_file("package.json"),
    check_file("backend/requirements.txt"),
    check_file("agents/scenario_agent/.env"),
])

# æ£€æŸ¥ç¯å¢ƒå˜é‡
os.chdir("agents/scenario_agent")
from dotenv import load_dotenv
load_dotenv()

env_ok = all([
    check_env_var("DEEPSEEK_API_KEY"),
    check_env_var("DEEPSEEK_BASE_URL"),
    check_env_var("MODEL_NAME"),
])

if files_ok and env_ok:
    print("\nğŸ‰ ç¯å¢ƒæ£€æŸ¥é€šè¿‡!")
    sys.exit(0)
else:
    print("\nâŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤ä¸Šè¿°é—®é¢˜")
    sys.exit(1)
```

## ğŸ“ è·å–å¸®åŠ©

### 1. æ”¶é›†è¯Šæ–­ä¿¡æ¯

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ”¶é›†ç³»ç»Ÿä¿¡æ¯ï¼š
```bash
# åˆ›å»ºè¯Šæ–­æŠ¥å‘Š
cat > diagnostic_info.txt << EOF
=== ç³»ç»Ÿä¿¡æ¯ ===
æ“ä½œç³»ç»Ÿ: $(uname -a)
Pythonç‰ˆæœ¬: $(python --version)
Node.jsç‰ˆæœ¬: $(node --version)
Dockerç‰ˆæœ¬: $(docker --version)

=== ç£ç›˜ç©ºé—´ ===
$(df -h)

=== å†…å­˜ä½¿ç”¨ ===
$(free -h)

=== ç«¯å£å ç”¨ ===
$(netstat -tulpn | grep -E ':(5173|8080|8002|8007)')

=== è¿›ç¨‹çŠ¶æ€ ===
$(ps aux | grep -E '(python|node|npm)')
EOF
```

### 2. è”ç³»æŠ€æœ¯æ”¯æŒ

æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥è·å¾—æ›´å¥½çš„æŠ€æœ¯æ”¯æŒï¼š
- æ“ä½œç³»ç»Ÿç‰ˆæœ¬
- é”™è¯¯æ—¥å¿—å†…å®¹
- éƒ¨ç½²æ­¥éª¤è®°å½•
- ç³»ç»Ÿé…ç½®ä¿¡æ¯
- è¯Šæ–­æŠ¥å‘Šæ–‡ä»¶

### 3. ç¤¾åŒºèµ„æº

- é¡¹ç›®æ–‡æ¡£: æŸ¥çœ‹é¡¹ç›®READMEå’Œæ–‡æ¡£
- é—®é¢˜è¿½è¸ª: åœ¨é¡¹ç›®ä»“åº“æäº¤Issue
- è®¨è®ºè®ºå›: å‚ä¸æŠ€æœ¯è®¨è®º

è®°ä½ï¼šå¤§å¤šæ•°é—®é¢˜éƒ½æœ‰è§£å†³æ–¹æ¡ˆï¼Œä¿æŒè€å¿ƒå¹¶ç³»ç»Ÿæ€§åœ°æ’æŸ¥é—®é¢˜ï¼
