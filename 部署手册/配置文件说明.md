# 配置文件详细说明

本文档详细说明了AI Agent攻防推演平台的各种配置文件和配置选项。

## 📁 配置文件概览

| 配置文件 | 位置 | 用途 | 必需性 |
|----------|------|------|--------|
| `.env` | `agents/scenario_agent/` | AI Agent配置 | 必需 |
| `.env` | `backend/` | 后端服务配置 | 可选 |
| `.env` | `docker/` | Docker环境配置 | 可选 |
| `package.json` | 项目根目录 | 前端依赖配置 | 必需 |
| `requirements.txt` | 项目根目录 | Python全局依赖 | 必需 |
| `requirements.txt` | `backend/` | 后端Python依赖 | 必需 |
| `vite.config.js` | 项目根目录 | 前端构建配置 | 必需 |
| `tailwind.config.js` | 项目根目录 | 样式框架配置 | 必需 |

## 🤖 AI Agent配置

### agents/scenario_agent/.env

这是最重要的配置文件，包含AI模型的API配置。

```env
# ===== 必需配置 =====

# DeepSeek API密钥 (必需)
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# API基础URL (必需)
DEEPSEEK_BASE_URL=https://api.deepseek.com

# 模型名称 (必需)
MODEL_NAME=deepseek-chat

# ===== 可选配置 =====

# 最大token数量 (默认: 4000)
MAX_TOKENS=4000

# 温度参数，控制输出随机性 (0.0-2.0，默认: 0.7)
TEMPERATURE=0.7

# API请求超时时间，单位秒 (默认: 30)
TIMEOUT=30

# 重试次数 (默认: 3)
MAX_RETRIES=3

# 重试间隔，单位秒 (默认: 1)
RETRY_DELAY=1

# 是否启用调试模式 (默认: False)
DEBUG_MODE=False

# 日志级别 (DEBUG, INFO, WARNING, ERROR, 默认: INFO)
LOG_LEVEL=INFO
```

### 配置说明

#### DEEPSEEK_API_KEY
- **说明**: DeepSeek平台的API密钥
- **获取方式**: 
  1. 访问 https://platform.deepseek.com/
  2. 注册账号并登录
  3. 在API密钥页面生成新的密钥
- **格式**: `sk-` 开头的字符串
- **安全提示**: 请妥善保管API密钥，不要提交到版本控制系统

#### TEMPERATURE
- **说明**: 控制AI输出的随机性和创造性
- **取值范围**: 0.0 - 2.0
- **推荐值**:
  - 0.1-0.3: 更确定性的输出，适合技术分析
  - 0.7: 平衡的输出，适合大多数场景
  - 1.0-1.5: 更有创造性的输出，适合场景生成

#### MAX_TOKENS
- **说明**: 单次API调用的最大token数量
- **影响**: 影响响应长度和API费用
- **推荐值**:
  - 2000: 简短回复
  - 4000: 标准回复 (推荐)
  - 8000: 详细回复

## 🔧 后端服务配置

### backend/.env

```env
# ===== 应用配置 =====

# 调试模式 (开发环境: True, 生产环境: False)
DEBUG=True

# 日志级别
LOG_LEVEL=INFO

# 应用端口 (默认: 8080)
PORT=8080

# 应用主机 (默认: 0.0.0.0)
HOST=0.0.0.0

# ===== 安全配置 =====

# JWT密钥 (生产环境必须修改)
SECRET_KEY=your-secret-key-here

# JWT过期时间，单位秒 (默认: 3600)
JWT_EXPIRATION=3600

# ===== CORS配置 =====

# 允许的源地址
CORS_ORIGINS=http://localhost:5173,http://localhost:3000,http://127.0.0.1:5173

# 是否允许凭证
CORS_ALLOW_CREDENTIALS=True

# ===== 数据库配置 =====

# 数据库URL (SQLite示例)
DATABASE_URL=sqlite:///./app.db

# 数据库连接池大小
DB_POOL_SIZE=10

# 数据库连接超时时间
DB_TIMEOUT=30

# ===== API配置 =====

# API版本前缀
API_PREFIX=/api/v1

# API请求限制 (每分钟请求数)
RATE_LIMIT=100

# ===== 文件上传配置 =====

# 最大文件大小，单位MB
MAX_FILE_SIZE=10

# 允许的文件类型
ALLOWED_FILE_TYPES=.txt,.json,.csv,.log

# 文件存储路径
UPLOAD_PATH=./uploads
```

## 🐳 Docker配置

### docker/.env

```env
# ===== MySQL配置 =====
MYSQL_ROOT_PASSWORD=rootpass
MYSQL_DATABASE=testdb
MYSQL_USER=testuser
MYSQL_PASSWORD=testpass

# ===== PostgreSQL配置 =====
POSTGRES_DB=sec_agent
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

# ===== Redis配置 =====
REDIS_PASSWORD=redis_pass

# ===== 公司信息配置 =====
COMPANY=ACME_CORP
DEPARTMENT=IT_SECURITY

# ===== 网络配置 =====
FRONTEND_NET=172.20.0.0/24
BACKEND_NET=172.21.0.0/24
SERVER_SEGMENT=192.168.200.0/24
DB_SEGMENT=192.168.214.0/24

# ===== 容器资源限制 =====
MEMORY_LIMIT=512m
CPU_LIMIT=0.5
```

## 🌐 前端配置

### vite.config.js

```javascript
import { fileURLToPath, URL } from "node:url";
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import vueDevTools from "vite-plugin-vue-devtools";

export default defineConfig({
  plugins: [vue(), vueDevTools()],
  
  resolve: {
    alias: {
      "@": fileURLToPath(new URL("./src", import.meta.url)),
    },
  },
  
  server: {
    // 开发服务器端口
    port: 5173,
    
    // 开发服务器主机
    host: '0.0.0.0',
    
    // 是否自动打开浏览器
    open: true,
    
    // 代理配置
    proxy: {
      "/api": {
        target: "http://localhost:8080",
        changeOrigin: true,
        // rewrite: (path) => path.replace(/^\/api/, '/api')
      },
      "/ws": {
        target: "ws://localhost:8080",
        ws: true,
        changeOrigin: true,
      },
    },
  },
  
  build: {
    // 构建输出目录
    outDir: 'dist',
    
    // 是否生成source map
    sourcemap: false,
    
    // 构建时是否压缩
    minify: 'terser',
    
    // chunk大小警告限制
    chunkSizeWarningLimit: 1000,
  },
});
```

### tailwind.config.js

```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        // 自定义颜色
        primary: '#1e40af',
        secondary: '#64748b',
        accent: '#f59e0b',
        danger: '#ef4444',
        success: '#10b981',
        warning: '#f59e0b',
      },
      fontFamily: {
        // 自定义字体
        sans: ['Inter', 'sans-serif'],
        mono: ['JetBrains Mono', 'monospace'],
      },
    },
  },
  plugins: [
    require('daisyui'),
  ],
  
  // DaisyUI配置
  daisyui: {
    themes: [
      "light",
      "dark",
      "cyberpunk",
      {
        security: {
          "primary": "#1e40af",
          "secondary": "#64748b",
          "accent": "#f59e0b",
          "neutral": "#374151",
          "base-100": "#ffffff",
          "info": "#3abff8",
          "success": "#36d399",
          "warning": "#fbbd23",
          "error": "#f87272",
        },
      },
    ],
    darkTheme: "dark",
    base: true,
    styled: true,
    utils: true,
    rtl: false,
    prefix: "",
    logs: true,
  },
}
```

## 📊 服务端口配置

### 默认端口分配

| 服务 | 默认端口 | 配置文件 | 修改方法 |
|------|----------|----------|----------|
| 前端开发服务器 | 5173 | `vite.config.js` | 修改 `server.port` |
| 后端API | 8080 | `backend/.env` | 设置 `PORT` 环境变量 |
| 场景服务 | 8002 | `services/scenario_service/main.py` | 修改代码中的端口 |
| 场景智能体 | 8007 | `agents/scenario_agent/main.py` | 修改代码中的端口 |
| 攻击服务 | 8003 | `services/attack_service/main.py` | 修改代码中的端口 |
| 防御服务 | 8004 | `services/defense_service/main.py` | 修改代码中的端口 |
| 评估服务 | 8005 | `services/evaluate_service/main.py` | 修改代码中的端口 |

### 端口冲突解决

如果遇到端口冲突，可以按以下步骤解决：

1. **查看端口占用**:
```bash
# Linux/macOS
netstat -tulpn | grep :8080
lsof -i :8080

# Windows
netstat -ano | findstr :8080
```

2. **修改配置文件**:
```env
# backend/.env
PORT=8081
```

3. **更新代理配置**:
```javascript
// vite.config.js
proxy: {
  "/api": {
    target: "http://localhost:8081", // 更新为新端口
    changeOrigin: true,
  },
}
```

## 🔐 安全配置建议

### 生产环境配置

```env
# backend/.env (生产环境)
DEBUG=False
LOG_LEVEL=WARNING
SECRET_KEY=your-very-secure-secret-key-here
CORS_ORIGINS=https://yourdomain.com
DATABASE_URL=postgresql://user:password@localhost:5432/sec_agent
```

### API密钥安全

1. **不要在代码中硬编码API密钥**
2. **使用环境变量存储敏感信息**
3. **定期轮换API密钥**
4. **限制API密钥的权限范围**
5. **监控API使用情况**

### 网络安全

```env
# 限制访问源
CORS_ORIGINS=https://yourdomain.com,https://admin.yourdomain.com

# 启用HTTPS
FORCE_HTTPS=True

# 设置安全头
SECURITY_HEADERS=True
```

## 🔧 性能优化配置

### 数据库连接池

```env
# 数据库连接池配置
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
```

### 缓存配置

```env
# Redis缓存配置
REDIS_URL=redis://localhost:6379/0
CACHE_TTL=3600
CACHE_MAX_SIZE=1000
```

### 日志配置

```env
# 日志配置
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=/var/log/sec_agent/app.log
LOG_MAX_SIZE=100MB
LOG_BACKUP_COUNT=5
```

这些配置选项可以根据您的具体需求进行调整。建议在开发环境中使用默认配置，在生产环境中根据实际情况进行优化。
